<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Création Patient</title>
    <link rel="stylesheet" href="header.css" />
    <link rel="stylesheet" href="creer_patient.css" />
    <link rel="stylesheet" href="liste_patient.css" />
    <link rel="stylesheet" href="base.css" />
    <link rel="stylesheet" href="layout.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link
      rel="icon"
      sizes="64x64"
      href="src/Images/logo.png"
      type="image/png"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body>
    <div class="header">
      <div class="tab1">
        <a href="creer_patient.html">
          <img src="src/Images/Patients.png" />
        </a>
      </div>
      <div class="tab2">
        <a href="sons.html">
          <img src="src/Images/Sons.png" alt="Sons" />
        </a>
      </div>
      <div class="header-title">
        <a href="index.html">Orchistraem</a>
      </div>
    </div>
    <div id="corps">
    
    <div id="liste_patient">
        <h1>Liste des Patients</h1>
        <input type="text" id="searchInput" class="form-control" placeholder="Rechercher un patient...">
        <ul id="patientsList">
            <!-- Les éléments de la liste des patients seront ajoutés ici dynamiquement -->
        </ul>

        <script>
            async function fetchAllPatientInfo() {
                try {
                    const response = await fetch('/all-patient-info');
                    if (response.ok) {
                        return await response.json();
                    } else {
                        console.error('Erreur lors de la récupération des informations des patients:', response.statusText);
                        return [];
                    }
                } catch (error) {
                    console.error('Erreur lors de la récupération des informations des patients:', error);
                    return [];
                }
            }

            document.addEventListener('DOMContentLoaded', async () => {
                const patientsList = document.getElementById('patientsList');

                // Récupérer les informations de tous les patients
                const patientInfos = await fetchAllPatientInfo();

                // Ajouter les éléments de liste pour chaque patient
                patientInfos.forEach(patient => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `${patient.name}`;
                    patientsList.appendChild(listItem);
                });

                // Ajouter un gestionnaire d'événement pour rediriger vers la page patient.html avec l'ID du patient
                patientsList.addEventListener('click', (event) => {
                    const listItem = event.target;
                    const patientIndex = Array.from(patientsList.children).indexOf(listItem);

                    if (patientIndex !== -1) {
                        const patientId = patientInfos[patientIndex].id;
                        window.location.href = `patient.html?id=${patientId}`;
                    }
                });
            });

            document.addEventListener('DOMContentLoaded', async () => {
            const patientsList = document.getElementById('patientsList');
            const searchInput = document.getElementById('searchInput');

            async function fetchAllPatientInfo() {
                try {
                    const response = await fetch('/all-patient-info');
                    if (response.ok) {
                        return await response.json();
                    } else {
                        console.error('Erreur lors de la récupération des informations des patients:', response.statusText);
                        return [];
                    }
                } catch (error) {
                    console.error('Erreur lors de la récupération des informations des patients:', error);
                    return [];
                }
            }

            function renderPatientList(patients) {
                patientsList.innerHTML = '';
                patients.forEach(patient => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `${patient.name}`;
                    patientsList.appendChild(listItem);
                });
            }

            // Récupérer les informations de tous les patients
            let allPatientInfos = await fetchAllPatientInfo();

            // Afficher la liste initiale de patients
            renderPatientList(allPatientInfos);

            // Ajouter un gestionnaire d'événement pour la recherche
            searchInput.addEventListener('input', () => {
                const searchTerm = searchInput.value.toLowerCase();
                const filteredPatients = allPatientInfos.filter(patient => patient.name.toLowerCase().includes(searchTerm));
                renderPatientList(filteredPatients);
            });

            // Ajouter un gestionnaire d'événement pour rediriger vers la page patient.html avec l'ID du patient
            patientsList.addEventListener('click', (event) => {
                const listItem = event.target;
                const patientIndex = Array.from(patientsList.children).indexOf(listItem);

                if (patientIndex !== -1) {
                    const patientId = allPatientInfos[patientIndex].id;
                    window.location.href = `patient.html?id=${patientId}`;
                }
            });
        });

        </script>
    </div>

    <div id="creer_patient">
    <h2 id="title-list">Création de patient</h2>
    <form
      action="/create-patient"
      method="POST"
      id="patientForm"
      enctype="multipart/form-data"
    >
      <div>
        <input
          class="form-control"
          type="text"
          id="nom"
          name="nom"
          required
          placeholder="Nom"
        />
      </div>
      <div>
        <input
          class="form-control"
          type="text"
          id="prenom"
          name="prenom"
          required
          placeholder="Prénom"
        />
      </div>
      <div>
        <input
          class="form-control"
          type="number"
          id="age"
          name="age"
          required
          placeholder="Age"
        />
      </div>

        <label>Choisir une image de profil :</label>
        <div id="chooseProfilPic">
            <!-- Garçons -->
            <div class="profile_pic">
                <img src="src/Images/profile_pics/garcon.png" alt="Garçon 1" /><br>
                <input type="radio" id="garcon1" name="profile_pic" value="garcon.png">
            </div>
            <div class="profile_pic">
                <img src="src/Images/profile_pics/garcon2.png" alt="Garçon 2" /><br>
                <input type="radio" id="garcon2" name="profile_pic" value="garcon2.png">
            </div>
            <div class="profile_pic">
                <img src="src/Images/profile_pics/garcon3.png" alt="Garçon 3" /><br>
                <input type="radio" id="garcon3" name="profile_pic" value="garcon3.png">
            </div>
        
            <!-- Filles -->
            <div class="profile_pic">
                <img src="src/Images/profile_pics/fille.png" alt="Fille 1" /><br>
                <input type="radio" id="fille1" name="profile_pic" value="fille.png">
            </div>
            <div class="profile_pic">
                <img src="src/Images/profile_pics/fille2.png" alt="Fille 2" /><br>
                <input type="radio" id="fille2" name="profile_pic" value="fille2.png">
            </div>
            <div class="profile_pic">
                <img src="src/Images/profile_pics/fille3.png" alt="Fille 3" /><br>
                <input type="radio" id="fille3" name="profile_pic" value="fille3.png">
            </div>
        
            <!-- Hommes -->
            <div class="profile_pic">
                <img src="src/Images/profile_pics/homme.png" alt="Homme 1" /><br>
                <input type="radio" id="homme1" name="profile_pic" value="homme.png">
            </div>
            <div class="profile_pic">
                <img src="src/Images/profile_pics/homme2.png" alt="Homme 2" /><br>
                <input type="radio" id="homme2" name="profile_pic" value="homme2.png">
            </div>
            <div class="profile_pic">
                <img src="src/Images/profile_pics/homme3.png" alt="Homme 3" /><br>
                <input type="radio" id="homme3" name="profile_pic" value="homme3.png">
            </div>
        
            <!-- Femmes -->
            <div class="profile_pic">
                <img src="src/Images/profile_pics/femme.png" alt="Femme 1" /><br>
                <input type="radio" id="femme1" name="profile_pic" value="femme.png">
            </div>
            <div class="profile_pic">
                <img src="src/Images/profile_pics/femme2.png" alt="Femme 2" /><br>
                <input type="radio" id="femme2" name="profile_pic" value="femme2.png">
            </div>
            <div class="profile_pic">
                <img src="src/Images/profile_pics/femme3.png" alt="Femme 3" /><br>
                <input type="radio" id="femme3" name="profile_pic" value="femme3.png">
            </div>
        
            <!-- Autres -->
            <div class="profile_pic">
                <img src="src/Images/profile_pics/autre.png" alt="Autre 1" /><br>
                <input type="radio" id="autre1" name="profile_pic" value="autre.png">
            </div>
            <div class="profile_pic">
                <img src="src/Images/profile_pics/autre2.png" alt="Autre 2" /><br>
                <input type="radio" id="autre2" name="profile_pic" value="autre2.png">
            </div>
            <div class="profile_pic">
                <img src="src/Images/profile_pics/autre3.png" alt="Autre 3" /><br>
                <input type="radio" id="autre3" name="profile_pic" value="autre3.png">
            </div>
        </div>
        
        <div>
          <button type="submit" class="btn btn-primary" onclick="resetFormAndRemoveHighlight()">Créer</button>
        </div>
    </form>
    </div>

  </div>

    <script src="dist/creer_patient.js"></script>
  </body>
</html>
